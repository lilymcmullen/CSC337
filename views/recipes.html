<!DOCTYPE html>
<html>
	<head>
		<title>Recipes Page</title>
		<meta charset="UTF-8" />
		<link rel="stylesheet" href="style.css" />
	</head>
	<header>
		<div>
			<div id="title">Byte-Sized Bites</div>
			<div id="account-info">
				<a id="login" href="login.html" style="margin-right: 8px"
					>Login</a
				>
				<a id="register" href="register.html">Register</a>
			</div>
		</div>

		<div id="navlinks" class="block" style="margin-top: 12px">
			<a href="index.html">Home</a>
			<a href="recipes.html">Explore Recipes</a>
			<a href="my_cookbook.html">My Cookbook</a>
			<a href="recipe_form.html">Add a Recipe</a>
		</div>
	</header>
	<body>
		<h1>Explore Recipes</h1>
		<div id="main_content" class="block">
			<div id="text_section">
				<p>
					Discover our variety of recipes on this page. Favorite the
					ones you love and save them to your personal cookbook for
					easy access!
				</p>
			</div>
			<div id="recipes_list" class="block">
				<!-- Recipes will be dynamically loaded here -->
			</div>
		</div>
		<script>
			async function loadRecipes() {
				const response = await fetch("/recipes/list");
				const recipes = await response.json();

				const recipesList = document.getElementById("recipes_list");
				recipesList.innerHTML = "";

				recipes.forEach((recipe) => {
				const recipeDiv = document.createElement("div");
				recipeDiv.className = "recipe";

				const title = document.createElement("h2");
				title.textContent = recipe.title;
				recipeDiv.appendChild(title);

				const ingredients = document.createElement("p");
				ingredients.innerHTML =
					"<strong>Ingredients:</strong><br>" +
					recipe.ingredients.replace(/\n/g, "<br>");
				recipeDiv.appendChild(ingredients);

				const instructions = document.createElement("p");
				instructions.innerHTML =
					"<strong>Instructions:</strong><br>" +
					recipe.instructions.replace(/\n/g, "<br>");
				recipeDiv.appendChild(instructions);

				const favoriteButton = document.createElement("button");
				favoriteButton.textContent = "Add to Cookbook";
				favoriteButton.onclick = async () => {
					const token = localStorage.getItem("authToken");
					if (!token) {
					alert("Please log in to add recipes to your cookbook.");
					return;
					}
					await fetch(`/favorites/add`, {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({
						recipeId: recipe._id,
					}),
					});
					alert("Recipe added to your cookbook!");
				};
				recipeDiv.appendChild(favoriteButton);

				recipesList.appendChild(recipeDiv);
				});
			}

			// Populate recipes on page load
			loadRecipes();
		</script>
	</body>
</html>
